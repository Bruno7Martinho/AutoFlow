<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>JS Cezar Serviços Automotivos</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>

<style>
body {
  font-family: Arial, sans-serif;
  background: #f2f2f2;
  padding: 20px;
}
h1 {
  text-align: center;
}
label {
  font-weight: bold;
}
input, select, textarea, button {
  width: 100%;
  padding: 8px;
  margin: 5px 0 15px 0;
}
.produto {
  background: #fff;
  padding: 10px;
  border-radius: 5px;
  margin-bottom: 10px;
}
button {
  background: #000;
  color: #FFD700;
  border: none;
  cursor: pointer;
}
button:hover {
  opacity: 0.9;
}
</style>
</head>

<body>

<h1>JS CEZAR SERVIÇOS AUTOMOTIVOS</h1>

<label>Nome do Cliente:</label>
<input type="text" id="cliente" placeholder="Nome do cliente">

<label>Data:</label>
<input type="date" id="data">

<label>Placa do Carro:</label>
<input type="text" id="placa">

<label>Modelo do Carro:</label>
<input type="text" id="modeloCarro">

<h3>Produtos / Serviços</h3>

<div id="produtos">
  <div class="produto">
    <select class="descricao">
      <option value="">Selecione</option>

      <optgroup label="Peças">
        <option>Parachoque Dianteiro</option>
        <option>Parachoque Traseiro</option>
        <option>Capô</option>
        <option>Farol</option>
        <option>Lanterna</option>
      </optgroup>

      <optgroup label="Serviços">
        <option>Chapeação</option>
        <option>Pintura</option>
        <option>Martelinho de Ouro</option>
        <option>Revitalização de Farol</option>
        <option>Embelezamento Automotivo</option>
      </optgroup>

      <option value="outro">Outro (manual)</option>
    </select>

    <input type="text" class="descricao-manual" placeholder="Descrição manual" style="display:none">
    <input type="number" class="quantidade" placeholder="Quantidade">
    <input type="number" class="valor" placeholder="Valor Unitário">
  </div>
</div>

<button onclick="adicionarProduto()">Adicionar Produto</button>
<button onclick="gerarPDF()">Gerar PDF</button>

<label>Observações:</label>
<textarea id="observacoes" rows="4"></textarea>

<img id="logo" src="logo.png" style="display:none">

<script>
// Mostrar campo manual
document.addEventListener('change', e => {
  if (e.target.classList.contains('descricao')) {
    const manual = e.target.parentElement.querySelector('.descricao-manual');
    manual.style.display = e.target.value === 'outro' ? 'block' : 'none';
  }
});

// Adicionar produto
function adicionarProduto() {
  const div = document.createElement('div');
  div.className = 'produto';
  div.innerHTML = document.querySelector('.produto').innerHTML;
  document.getElementById('produtos').appendChild(div);
}

// Formatador data
function formatarData(data) {
  if (!data) return '';
  const [a, m, d] = data.split('-');
  return `${d}/${m}/${a}`;
}

// Número orçamento
function gerarNumeroOrcamento() {
  return Math.floor(1000 + Math.random() * 9000);
}

async function gerarPDF() {

  const cliente = document.getElementById('cliente').value.trim();
  const placa = document.getElementById('placa').value.trim();
  if (!cliente || !placa) {
    alert('Informe o nome do cliente e a placa.');
    return;
  }

  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  const pageWidth = doc.internal.pageSize.getWidth();

  let y = 20;

  // Cabeçalho
  doc.setFontSize(14);
  doc.setFont(undefined, 'bold');
  doc.text('JS CEZAR SERVIÇOS AUTOMOTIVOS', pageWidth / 2, y, { align: 'center' });

  y += 6;
  doc.setFontSize(10);
  doc.setFont(undefined, 'normal');
  doc.text(
    'Chapeação • Pintura • Revitalização • Martelinho de Ouro\n' +
    'Revitalização de Farol • Embelezamento Automotivo',
    pageWidth / 2,
    y,
    { align: 'center' }
  );

  y += 14;
  doc.text('CNPJ: 35.487.391/0001-03', 14, y);
  doc.text('WhatsApp: (51) 99723-6855', 14, y + 6);
  doc.text('Rua Rio de Janeiro, 979 – Sapucaia do Sul – RS', 14, y + 12);

  y += 22;
  doc.text(`ORÇAMENTO Nº: ${gerarNumeroOrcamento()}`, 14, y);
  doc.text(`DATA: ${formatarData(document.getElementById('data').value)}`, 140, y);

  y += 8;
  doc.text(`CLIENTE: ${cliente}`, 14, y);
  doc.text(`PLACA: ${placa}`, 140, y);

  y += 8;
  doc.text(`MODELO: ${document.getElementById('modeloCarro').value}`, 14, y);

  // Produtos
  const rows = [];
  let total = 0;

  document.querySelectorAll('.produto').forEach(p => {
    const desc = p.querySelector('.descricao').value;
    const manual = p.querySelector('.descricao-manual').value;
    const qtd = Number(p.querySelector('.quantidade').value);
    const val = Number(p.querySelector('.valor').value);

    if (!desc || qtd <= 0 || val <= 0) return;

    const finalDesc = manual || desc;
    const subtotal = qtd * val;
    total += subtotal;

    rows.push([
      finalDesc,
      qtd,
      `R$ ${val.toFixed(2)}`,
      `R$ ${subtotal.toFixed(2)}`
    ]);
  });

  doc.autoTable({
    startY: y + 10,
    head: [['DESCRIÇÃO', 'QTD', 'VALOR', 'TOTAL']],
    body: rows,
    theme: 'grid'
  });

  y = doc.lastAutoTable.finalY + 10;
  doc.setFontSize(14);
  doc.setFont(undefined, 'bold');
  doc.text(`TOTAL GERAL: R$ ${total.toFixed(2)}`, 14, y);

  const obs = document.getElementById('observacoes').value;
  if (obs) {
    y += 10;
    doc.setFontSize(11);
    doc.text('OBSERVAÇÕES:', 14, y);
    doc.rect(14, y + 4, 180, 30);
    doc.text(doc.splitTextToSize(obs, 175), 16, y + 10);
  }

  doc.save('Orcamento_JS_Cezar.pdf');
}

</script>

</body>
</html>